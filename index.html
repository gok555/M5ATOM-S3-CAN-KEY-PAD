<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>M5Atom CAN KEYPAD</title>
<style>
button {
    font-size: 22px;
    margin: 8px;
    padding: 12px 18px;
}
#log {
    margin-top: 20px;
    font-size: 20px;
    white-space: pre-line;
}
</style>
</head>
<body>

<h2>M5Atom CAN KEYPAD</h2>

<button id="connect">üîµ BLE Êé•Á∂ö</button>
<br><br>

<button onclick="sendKey(1)">BTN1</button>
<button onclick="sendKey(2)">BTN2</button>
<button onclick="sendKey(3)">BTN3</button>
<button onclick="sendKey(4)">BTN4</button><br>
<button onclick="sendKey(5)">BTN5</button>
<button onclick="sendKey(6)">BTN6</button>
<button onclick="sendKey(7)">BTN7</button>
<button onclick="sendKey(8)">BTN8</button>

<div id="log"></div>

<script>
let device = null;
let characteristic = null;

// -------------------------------
// BLE Êé•Á∂ö
// -------------------------------
document.getElementById("connect").onclick = async () => {
    try {
        device = await navigator.bluetooth.requestDevice({
            filters: [{ name: "M5AtomS3_CAN" }],
            optionalServices: ["6E400001-B5A3-F393-E0A9-E50E24DCCA9E"]
        });

        const server = await device.gatt.connect();
        const service = await server.getPrimaryService("6E400001-B5A3-F393-E0A9-E50E24DCCA9E");

        characteristic = await service.getCharacteristic("6E400002-B5A3-F393-E0A9-E50E24DCCA9E");

        log("BLE Connected");
    } catch (e) {
        log("BLE Error: " + e);
    }
};

// -------------------------------
// „Éú„Çø„É≥ÈÄÅ‰ø°Ôºà1„Äú8Ôºâ
// -------------------------------
function sendKey(num) {
    if (!characteristic) {
        log("‚ö† BLEÊú™Êé•Á∂ö");
        return;
    }
    const data = new TextEncoder().encode(String(num));
    characteristic.writeValue(data);
    log("SEND ‚Üí " + num);
}

// -------------------------------
function log(t) {
    document.getElementById("log").innerText += t + "\n";
}
</script>
</body>
</html>
